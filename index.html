<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rugby Stats Tracker</title>
    <style>
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .team-section { display: flex; justify-content: space-around; }
        .player-list { border: 2px dashed #ccc; min-height: 100px; padding: 10px; margin: 10px; }
        .player { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 5px; 
            cursor: pointer;
            border-radius: 4px;
        }
        .player.selected { 
            background: #add8e6; 
            border: 2px solid #4a90e2;
        }
        .player-controls { display: none; margin-top: 5px; }
        .player.selected .player-controls { display: block; }
        .history-log { 
            height: 300px; 
            overflow-y: auto; 
            border: 1px solid #ccc; 
            padding: 10px;
            margin: 20px 0;
        }
        .timestamp { color: #666; font-size: 0.8em; }
        .score-buttons button, .match-controls button {
            margin: 5px;
            padding: 8px 15px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Rugby Stats Tracker</h1>
        
        <div class="team-section">
            <div class="team">
                <h2>Our Team</h2>
                <div class="score-buttons">
                    <button onclick="updateScore('home', 5, 'Try')">Try</button>
                    <button onclick="updateScore('home', 2, 'Conversion')">Conversion</button>
                    <button onclick="updateScore('home', 3, 'Penalty')">Penalty</button>
                    <button onclick="updateScore('home', 3, 'Drop Goal')">Drop Goal</button>
                </div>
                <h3>Score: <span id="home-score">0</span></h3>
                
                <h3>Bench</h3>
                <div id="player-pool" class="player-list"></div>
                
                <h3>On Field</h3>
                <div id="active-players" class="player-list"></div>
                <button onclick="recordSubstitution()">Make Substitution</button>
            </div>

            <div class="team">
                <h2>Opposition</h2>
                <div class="score-buttons">
                    <button onclick="updateScore('away', 5, 'Try')">Try</button>
                    <button onclick="updateScore('away', 2, 'Conversion')">Conversion</button>
                    <button onclick="updateScore('away', 3, 'Penalty')">Penalty</button>
                    <button onclick="updateScore('away', 3, 'Drop Goal')">Drop Goal</button>
                </div>
                <h3>Score: <span id="away-score">0</span></h3>
            </div>
        </div>

        <div class="match-controls">
            <button onclick="startMatch()">Start Match</button>
            <button onclick="saveMatch()">Save Match</button>
            <button onclick="loadMatch()">Load Match</button>
        </div>

        <h3>Match History</h3>
        <div id="history-log" class="history-log"></div>
    </div>

    <script>
        const POSITIONS = ['Prop1', 'Hooker','Prop2' 'Lock1', 'Lock2', 'Flanker1', 'Flanker2', '8man', 'Wing1', 'Scrum-half', 'Fly-half', 'Inside Center','Outside Center' 'Wing2', 'Fullback'];
        let matchData = {
            startTime: null,
            scores: { home: 0, away: 0 },
            events: [],
            players: []
        };

        function createPlayer(name, number, position) {
            const positionOptions = POSITIONS.map(pos => 
                `<option value="${pos}" ${pos === position ? 'selected' : ''}>${pos}</option>`
            ).join('');

            const playerDiv = document.createElement('div');
            playerDiv.className = 'player';
            playerDiv.dataset.id = number;
            playerDiv.innerHTML = `
                <div class="player-info">Player ${name} #${number} (${position})</div>
                <div class="player-controls">
                    <select onchange="updatePosition(this)">
                        ${positionOptions}
                    </select>
                </div>
            `;
            return playerDiv;
        }

        function initializePlayers() {
            const playerPool = document.getElementById('player-pool');
            playerPool.innerHTML = '';
            
            // Create 15 players with default positions
            for (let i = 1; i <= 15; i++) {
                const position = POSITIONS[Math.min(i - 1, POSITIONS.length - 1)];
                const player = createPlayer(i, i, position);
                playerPool.appendChild(player);
                matchData.players.push({id: i, position: position, status: 'bench'});
            }
        }

        function startMatch() {
            matchData.startTime = new Date();
            matchData.scores = { home: 0, away: 0 };
            matchData.events = [];
            document.getElementById('home-score').textContent = '0';
            document.getElementById('away-score').textContent = '0';
            document.getElementById('history-log').innerHTML = '';
            logEvent('Match Started');
        }

        function updateScore(team, points, type) {
            matchData.scores[team] += points;
            document.getElementById(`${team}-score`).textContent = matchData.scores[team];
            logEvent(`${team.toUpperCase()} - ${type} (+${points})`);
        }

        function updatePosition(select) {
            const player = select.closest('.player');
            const playerInfo = player.querySelector('.player-info');
            const newPosition = select.value;
            const playerText = playerInfo.textContent.split(' (')[0];
            playerInfo.textContent = `${playerText} (${newPosition})`;
            
            const playerId = player.dataset.id;
            const playerData = matchData.players.find(p => p.id === parseInt(playerId));
            if (playerData) {
                const oldPosition = playerData.position;
                playerData.position = newPosition;
                logEvent(`Position Change: ${playerText} from ${oldPosition} to ${newPosition}`);
            }
        }

        function recordSubstitution() {
            const out = document.querySelector('#active-players .player.selected');
            const in = document.querySelector('#player-pool .player.selected');
            
            if (!out || !in) {
                alert('Select players to substitute');
                return;
            }

            [out.parentElement.appendChild(in), in.parentElement.appendChild(out)];
            
            const outInfo = out.querySelector('.player-info').textContent;
            const inInfo = in.querySelector('.player-info').textContent;
            logEvent(`Substitution: ${outInfo.split(' (')[0]} OFF, ${inInfo.split(' (')[0]} ON`);
            
            // Update player statuses
            matchData.players.find(p => p.id === parseInt(out.dataset.id)).status = 'bench';
            matchData.players.find(p => p.id === parseInt(in.dataset.id)).status = 'field';
            
            document.querySelectorAll('.selected').forEach(p => p.classList.remove('selected'));
        }

        function logEvent(event) {
            const time = matchData.startTime ? 
                new Date(new Date() - matchData.startTime)
                    .toISOString()
                    .substr(11, 8) : 
                '00:00:00';
            
            matchData.events.push({ time, event });
            
            const historyLog = document.getElementById('history-log');
            historyLog.insertAdjacentHTML('beforeend', 
                `<div><span class="timestamp">[${time}]</span> ${event}</div>`);
            historyLog.scrollTop = historyLog.scrollHeight;
        }

        function saveMatch() {
            localStorage.setItem('lastMatch', JSON.stringify(matchData));
            alert('Match saved!');
        }

        function loadMatch() {
            const saved = localStorage.getItem('lastMatch');
            if (!saved) return alert('No saved match found!');

            matchData = JSON.parse(saved);
            
            // Restore scores
            document.getElementById('home-score').textContent = matchData.scores.home;
            document.getElementById('away-score').textContent = matchData.scores.away;
            
            // Restore history
            const historyLog = document.getElementById('history-log');
            historyLog.innerHTML = matchData.events
                .map(e => `<div><span class="timestamp">[${e.time}]</span> ${e.event}</div>`)
                .join('');
            
            // Restore players
            initializePlayers();
            matchData.players.forEach(player => {
                const playerElement = document.querySelector(`[data-id="${player.id}"]`);
                if (playerElement) {
                    const container = player.status === 'field' ? 
                        document.getElementById('active-players') : 
                        document.getElementById('player-pool');
                    container.appendChild(playerElement);
                }
            });
        }

        // Initialize click handlers
        document.addEventListener('click', e => {
            if (e.target.classList.contains('player')) {
                const container = e.target.parentElement;
                container.querySelectorAll('.selected')
                    .forEach(p => p !== e.target && p.classList.remove('selected'));
                e.target.classList.toggle('selected');
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializePlayers);
    </script>
</body>
</html>
